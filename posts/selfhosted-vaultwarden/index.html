<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://MrLeeYoungHoo.github.io/favicon.ico><meta property="og:url" content="https://MrLeeYoungHoo.github.io/posts/selfhosted-vaultwarden/"><meta property="og:site_name" content="YEO'S BLOG"><meta property="og:title" content="åœ¨Debian12ä¸Šç”¨dockeréƒ¨ç½²Vaultwarden"><meta property="og:description" content="ç§Ÿäº†ä¸€ä¸ªè…¾è®¯äº‘è½»é‡æŒ‚vaultwardenï¼Œè®°å½•ä¸€ä¸‹éƒ¨ç½²è¿‡ç¨‹ï¼Œåˆ°æœŸåvpsæ¬å®¶é‡å»ºå¯èƒ½ç”¨çš„åˆ°ã€‚"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-04-15T17:35:25+08:00"><meta property="article:modified_time" content="2025-04-15T17:35:25+08:00"><meta property="article:tag" content="å¤‡å¿˜å½•"><meta property="article:tag" content="è‡ªéƒ¨ç½²"><meta property="article:tag" content="Vaultwarden"><title>YEO'S BLOG | åœ¨Debian12ä¸Šç”¨dockeréƒ¨ç½²Vaultwarden</title>
<link rel=stylesheet href=/css/main.min.381663dce579bb2c53e19714e9ec93f28111c9deee89f20a55e3a9f331ffeded.css integrity="sha256-OBZj3OV5uyxT4ZcU6eyT8oERyd7uifIKVeOp8zH/7e0=" crossorigin=anonymous><link rel=stylesheet href=/css/palette/candy.min.aef1f5455084f956ca306aae22d76c4889d9a26ab27077e5e059370f4bef70f6.css integrity="sha256-rvH1RVCE+VbKMGquItdsSInZomqycHfl4Fk3D0vvcPY=" crossorigin=anonymous><script src=/js/main.86bb3d8e6f46df0fc97c2731e6b99175a13b87a4086acf578ff9b6992fcf32c1.js integrity="sha256-hrs9jm9G3w/JfCcx5rmRdaE7h6QIas9Xj/m2mS/PMsE=" crossorigin=anonymous></script><link href=https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css rel=stylesheet integrity=sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH crossorigin=anonymous></head><body><main><div class="container pt-5"><div class="row mt-5 pt-5"><nav aria-label=breadcrumb class=small><ol class="breadcrumb fw-bold"><li class=breadcrumb-item><a href=/>ä¸»é¡µğŸ </a></li><li class=breadcrumb-item><a href=/about>å…³äºâ„¹ï¸</a></li><li class=breadcrumb-item><a href=/posts class="text-decoration-underline link-offset-3">blogğŸ“œ</a></li></ol></nav></div><div class="d-none d-lg-block position-fixed end-0 small toc"><p class=toc-title>Table of Contents:</p><nav id=TableOfContents><ul><li><a href=#5æœˆ29æ—¥æ›´æ–°>5æœˆ29æ—¥æ›´æ–°</a></li><li><a href=#å‰æœŸå‡†å¤‡>å‰æœŸå‡†å¤‡</a></li><li><a href=#å¼€å§‹éƒ¨ç½²>å¼€å§‹éƒ¨ç½²</a><ul><li><a href=#è®¾å®šæ•°æ®ä¿å­˜ä½ç½®>è®¾å®šæ•°æ®ä¿å­˜ä½ç½®</a></li><li><a href=#ç¼–è¾‘é…ç½®docker-composeymlæ–‡ä»¶>ç¼–è¾‘é…ç½®<code>docker-compose.yml</code>æ–‡ä»¶</a></li><li><a href=#ä½¿ç”¨é»˜è®¤sqliteçš„docker-composeymlæ–‡ä»¶>ä½¿ç”¨é»˜è®¤<code>sqlite</code>çš„<code>docker-compose.yml</code>æ–‡ä»¶</a></li><li><a href=#ç¼–è¾‘envç¯å¢ƒå˜é‡>ç¼–è¾‘<code>.env</code>ç¯å¢ƒå˜é‡</a></li><li><a href=#é…ç½®åå‘ä»£ç†>é…ç½®åå‘ä»£ç†</a></li></ul></li><li><a href=#é…ç½®fail2ban>é…ç½®<code>fail2ban</code></a><ul><li><a href=#è®¾ç½®ç½‘é¡µç«¯çš„fail2ban>è®¾ç½®ç½‘é¡µç«¯çš„<code>fail2ban</code></a></li><li><a href=#è®¾ç½®ç½‘é¡µç«¯adminç®¡ç†ç•Œé¢çš„fail2ban>è®¾ç½®ç½‘é¡µç«¯<code>admin</code>ç®¡ç†ç•Œé¢çš„<code>fail2ban</code></a></li><li><a href=#totpçš„fail2banè®¾ç½®ç”¨äºvaultwardenå¸å·è®¾ç½®äº†äºŒæ¬¡éªŒè¯çš„><code>TOTP</code>çš„<code>fail2ban</code>è®¾ç½®,ç”¨äº<code>vaultwarden</code>å¸å·è®¾ç½®äº†äºŒæ¬¡éªŒè¯çš„</a></li></ul></li><li><a href=#å‚è€ƒ>å‚è€ƒ</a></li></ul></nav></div><div class=post><header class=mb-4><h1 class=text-uppercase>åœ¨Debian12ä¸Šç”¨dockeréƒ¨ç½²Vaultwarden</h1><div aria-label=breadcrumb><ol class=breadcrumb><li class="breadcrumb-item small"><time datetime=2025-04-15T17:35:25+08:00>April 15, 2025</time></li><li class="breadcrumb-item small">3 minutes</li></ol></div></header><article><h2 id=5æœˆ29æ—¥æ›´æ–°>5æœˆ29æ—¥æ›´æ–°</h2><ol><li>å®Œå–„äº†<code>compose</code>æ–‡ä»¶é…ç½®çš„ä¸€éƒ¨åˆ†è§£é‡Šï¼Œæ–°å¢äº†ç”¨é»˜è®¤sqliteæ•°æ®åº“çš„é…ç½®æ¨¡æ¿</li><li>ä½¿ç”¨<code>apt install fail2ban</code>å®‰è£…çš„fail2bançš„è®¾ç½®äº‹å®œ</li></ol><hr><blockquote><p>å¤§è‡´æ­¥éª¤ï¼š</p><ol><li>åœ¨åˆé€‚çš„ä½ç½®åˆ›å»ºæ–‡ä»¶å¤¹ä¿å­˜<code>docker-compose.yml</code>æ–‡ä»¶å’Œæ•°æ®åº“æ•°æ®</li><li>é…ç½®<code>docker-compose.yml</code>æ–‡ä»¶ï¼Œé…ç½®å¥½åè¿è¡Œ <code>docker compose up -d</code>è¿è¡ŒæœåŠ¡</li><li>é…ç½®åå‘ä»£ç†</li><li>é…ç½®fail2ban é˜²æ­¢å¯†ç ç®¡ç†å™¨å¸å·è¢«æš´åŠ›ç ´è§£</li></ol></blockquote><h2 id=å‰æœŸå‡†å¤‡>å‰æœŸå‡†å¤‡</h2><ul><li>ä¸€ä¸ªvpsæœåŠ¡å™¨</li><li>ä¸€ä¸ªåŸŸåï¼Œå·²ç»dnsè§£æåˆ°æœåŠ¡å™¨çš„ipåœ°å€(ä¸‹æ–‡ç”¨<code>example.com</code>æ›¿ä»£ï¼Œè‡ªè¡Œæ›¿æ¢æˆä½ è‡ªå·±çš„)</li></ul><h2 id=å¼€å§‹éƒ¨ç½²>å¼€å§‹éƒ¨ç½²</h2><h3 id=è®¾å®šæ•°æ®ä¿å­˜ä½ç½®>è®¾å®šæ•°æ®ä¿å­˜ä½ç½®</h3><p>æˆ‘å–œæ¬¢åœ¨<code>/home</code>æ–‡ä»¶å¤¹å­˜æ”¾dockerå®¹å™¨çš„æ•°æ®,å› æ­¤åˆ›å»ºå¹¶è¿›å…¥<code>/home/docker_apps/vaultwarden</code>æ–‡ä»¶å¤¹:</p><pre tabindex=0><code>cd /home
mkdir docker_apps docker_apps/vaultwarden
</code></pre><p>è¿›å…¥åˆšåˆšåˆ›å»ºçš„æ–‡ä»¶å¤¹ï¼Œåˆ›å»º<code>docker-compose.yml</code>æ–‡ä»¶å¹¶ç¼–è¾‘</p><pre tabindex=0><code>cd docker_apps/vaultwarden
vim docker-compose.yml
</code></pre><p>é”®å…¥<code>i</code>è¿›å…¥ç¼–è¾‘æ¨¡å¼(å·¦ä¸‹è§’æ˜¾ç¤º<code>--insert--</code>)</p><h3 id=ç¼–è¾‘é…ç½®docker-composeymlæ–‡ä»¶>ç¼–è¾‘é…ç½®<code>docker-compose.yml</code>æ–‡ä»¶</h3><p>æŒ‰ç…§<a href=https://github.com/dani-garcia/vaultwarden/wiki>å®˜æ–¹wiki</a>è¿›è¡Œé…ç½®ï¼Œæˆ–è€…æŸ¥çœ‹<a href=https://rs.ppgg.in/configuration/configuration-overview>æ±‰åŒ–ç‰ˆ</a></p><p>æˆ‘çš„<code>docker-compose.yml</code>æ–‡ä»¶(ä½¿ç”¨äº†postgresqlæ•°æ®åº“)ï¼š</p><pre tabindex=0><code>services:
  vaultwarden:
    image: vaultwarden/server:latest
    container_name: vaultwarden
    volumes:
      - ./vw-data/:/persistent/ 
      - ./vw-attachments/:/attachments/
      
     # - ./vw-database/:/database/
     #å¯ç”¨é»˜è®¤çš„æ•°æ®åº“æ—¶å¯ç”¨,å¹¶æ³¨é‡Šæ‰ä¸‹æ–‡çš„â€˜- DATABASE_URL=â€™,è¿™é‡Œå¯ç”¨äº†postgresqlå°±ä¸å¯ç”¨äº†
      
      - /icon_cache/ #è¿™æ ·å­åæ¯æ¬¡æ›´æ–°ä¼šæ¸…é™¤å›¾æ ‡ï¼Œå¯ä»¥å¯é¿å…ä¿ç•™è¿‡æ—¶çš„å›¾æ ‡
      - ./logs/:/fail2banlogs/ 
      #logæ—¥å¿—æ–‡ä»¶,å¯ç”¨fail2banæ—¶éœ€è¦
    restart: unless-stopped
    depends_on: 
     - db
    ports:
      - &#34;127.0.0.1:8888:80&#34;
    environment:
      - DOMAIN=https://example.com #è¾“å…¥ä½ è‡ªå·±çš„åŸŸå
      
    # - SIGNUPS_DOMAINS_WHITELIST=gmail.com,outlook.com,hotmail.com,qq.com
      #å¯ç”¨å&#34;SIGNUPS_ALLOWED&#34;å°†å¤±æ•ˆ,å§‹ç»ˆå¯ä½¿ç”¨ä¸‹é¢è®¾ç½®çš„é‚®ç®±åŸŸååç¼€æ³¨å†Œ
      #å¦‚æœä¸å¯ç”¨é‚®ä»¶æœåŠ¡,å¯è®¾ç½®ä¸€ä¸ªå…¶ä»–äººä¸çŸ¥é“çš„åŸŸååç¼€æ¥è¾¾åˆ°ç¦æ­¢å…¶ä»–äººæ³¨å†Œ
      #ä¸è¿‡å¯†ç ç®¡ç†å™¨è¿™ç§ä¸œè¥¿å¾ˆå°‘æœ‰äººä¼šå»ä¸€ä¸ªä¸æ˜ç½‘ç«™æ³¨å†Œä¸€ä¸ªç„¶åæ‹¿æ¥ç”¨å§

      - WEB_VAULT_ENABLED=true #å¯ç”¨ç½‘é¡µé¡µé¢

      - SIGNUPS_ALLOWED=false  
      #å¯ç”¨åç¦æ­¢æ³¨å†Œï¼Œåªèƒ½ç™»å½•ç®¡ç†å‘˜é¡µé¢å»é‚€è¯·ç”¨æˆ·,å¯ç”¨SIGNUPS_ALLOWEDåå¤±æ•ˆ
      - SIGNUPS_VERIFY=true    
      #å¯ç”¨æ³¨å†ŒéªŒè¯ï¼Œå³å¾€æ³¨å†Œå¸å·çš„é‚®ç®±å‘é€éªŒè¯
      - ADMIN_TOKEN=${VAULTWARDEN_ADMIN_TOKEN} 
      #å¯ç”¨ç®¡ç†å‘˜ç•Œé¢ï¼Œhttps://åŸŸå/admin ç™»å½•,è¿™äº›åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®çš„éƒ½å¯ä»¥åœ¨ä¸Šé¢å†é…ç½® 

        # æ•°æ®æ˜ å°„
      - DATA_FOLDER=/persistent 
    # - DATABASE_URL=/database/vaultwarden.sqlite3  
    #ä½¿ç”¨é»˜è®¤æ•°æ®åº“æ—¶å¯ç”¨ï¼Œä½¿ç”¨å…¶ä»–æ•°æ®åº“æ—¶å°†æ­¤æ¡æ³¨é‡Šæ‰

      - DATABASE_URL=postgres://${DB_USER}:${DB_SECRET}@db/${DB_NAME}?sslmode=disable 
      #ä½¿ç”¨é»˜è®¤æ•°æ®åº“æ—¶ï¼Œå°†æ­¤æ¡æ³¨é‡Šæ‰

      - ATTACHMENTS_FOLDER=/attachments
      - ICON_CACHE_FOLDER=/icon_cache
      - ROCKET_WORKERS=20 

        #(å¯é€‰)å¯ç”¨bitwardençš„push,è®¿é—®https://bitwarden.com/host/ è¾“å…¥é‚®ç®±æ³¨å†Œ,åœ°åŒºé€‰çš„ç¾å›½
        #åœ¨ç½‘é¡µç«¯ç™»å½•è¿‡,ç„¶åä¸‹æ¬¡å†ç™»å½•éœ€è¦ä½ é‡å¤è¾“å…¥å¯†ç æ—¶ä¼šå¤šå‡ºä¸€ä¸ªç”¨å…¶ä»–è®¾å¤‡ç™»å½•
        #ç‚¹å‡»é‚£ä¸ªæŒ‰é’®å¯ç”¨åœ¨æ‰‹æœº&#34;è®¾ç½®-å¾…å¤„ç†çš„ç™»å½•è¯·æ±‚æ‰¹å‡†ç™»å½•&#34;
        #è®¾ç½®å®Œè¿™ä¸ªå,ä¼šç»™ä½ æ‰‹æœºæ¨é€ä¸€ä¸ªæ¶ˆæ¯,iOSäº²æµ‹å¯ç”¨,å…¶ä»–ç³»ç»Ÿè‡ªæµ‹
      - PUSH_ENABLED=true
      - PUSH_INSTALLATION_ID=       #å°†æ³¨å†Œçš„idå¤åˆ¶è‡³æ­¤
      - PUSH_INSTALLATION_KEY=      #å°†æ³¨å†Œçš„keyå¤åˆ¶è‡³æ­¤

        #é€šçŸ¥é‚®ä»¶çš„é…ç½®
        #æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯è‡ªå»ºé‚®ç®±,gmailçš„è®¾ç½®å¯ç”¨å»å®˜æ–¹wikiæŸ¥çœ‹
      - SMTP_HOST=
      - SMTP_PORT=587
      - SMTP_SECURITY=starttls
      - SMTP_FROM=${SMTP_FROM}
      - SMTP_USERNAME=${SMTP_USER}
      - SMTP_PASSWORD=${SMTP_PASSWD}
  
      - SHOW_PASSWORD_HINT=false   #å¯†ç æç¤º
        
      - LOG_FILE=/fail2banlogs/vaultwarden.log      #æ—¥å¿—æ–‡ä»¶,é…åˆfail2banä½¿ç”¨
      - LOG_LEVEL=info
      - EXTENDED_LOGGING=true
        # - ENABLE_WEBSOCKET=false # ç¦ç”¨websocket,å»ºè®®åˆ«ç¦
        
  
  #ä½¿ç”¨ä½ å–œæ¬¢çš„æ•°æ®åº“,postgresçš„è¯å¯ç”¨è®¾ç½®16æˆ–è€…17,æˆ‘è¿™ä¸ªæ¯”è¾ƒæ—©ä»¥å‰å¼„å¾—æ˜¯15,æœ€å¥½å›ºå®šç‰ˆæœ¬
  db:
    image: postgres:15  
    container_name: postgres_vaultwarden
    environment:
        - POSTGRES_DB=${DB_NAME}
        - POSTGRES_USER=${DB_USER}

        - POSTGRES_PASSWORD=${DB_SECRET} 
        #ç‰¹æ®Šå­—ç¬¦è¦ç‰¹åˆ«è®¾ç½®è½¬ä¹‰å­—ç¬¦ï¼Œæ‡’å¾—æŠ˜è…¾å¯ç”¨ä»…ä½¿ç”¨å¤§å°å†™çš„å­—æ¯å’Œæ•°å­—
    volumes:
        - ./db:/var/lib/postgresql/data
    restart: unless-stopped
</code></pre><p>ä¿®æ”¹å¥½åé”®å…¥<code>:wq</code>æŒ‰ä¸‹å›è½¦é€€å‡º</p><h3 id=ä½¿ç”¨é»˜è®¤sqliteçš„docker-composeymlæ–‡ä»¶>ä½¿ç”¨é»˜è®¤<code>sqlite</code>çš„<code>docker-compose.yml</code>æ–‡ä»¶</h3><pre tabindex=0><code>services:
  vaultwarden:
    image: vaultwarden/server:latest
    container_name: vaultwarden
    volumes:
      - ./vw-data/:/persistent/
      - ./vw-attachments/:/attachments/
      - ./vw-database/:/database/
      - /icon_cache/ # å‡çº§åä¼šæ¸…é™¤å›¾æ ‡
      - ./vw-logs/:/f2blogs/ # logæ—¥å¿—æ–‡ä»¶ä½ç½®,å¦‚æœä½¿ç”¨fail2banéœ€è¦
    restart: unless-stopped
    ports:
      - &#34;127.0.0.1:8888:80&#34;
    environment:
        # webä»¥åŠåŸºæœ¬é…ç½®
      - DOMAIN=https://example.com
      - WEB_VAULT_ENABLED=true # å¯ç”¨ç½‘é¡µé¡µé¢
      - SIGNUPS_ALLOWED=false # å¯ç”¨ç¦æ­¢æ³¨å†Œ
      - SIGNUPS_VERIFY=true # å¯ç”¨æ³¨å†ŒéªŒè¯
      - ADMIN_TOKEN=${VAULTWARDEN_ADMIN_TOKEN} # å¯ç”¨ç®¡ç†å‘˜ç•Œé¢ 

        #æ•°æ®æ˜ å°„
      - DATA_FOLDER=/persistent 
      - ATTACHMENTS_FOLDER=/attachments
      - DATABASE_URL=/database/vaultwarden.sqlite3
      - ICON_CACHE_FOLDER=/icon_cache
      - ROCKET_WORKERS=20 

        #å¯ç”¨bitwardençš„push,å‰ææ˜¯ä½ æ˜¯ç”¨bitwardençš„å®˜æ–¹å®¢æˆ·ç«¯
        #å¦‚æœä½¿ç”¨keyguard(å®‰å“)è¿™ç§å¼€æºç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯,ä¸çŸ¥é“æœ‰æ²¡æœ‰æ¨é€
        #IDå’Œkeyè®¿é—®https://bitwarden.com/host/ å¡«å…¥é‚®ç®±è·å¾—,åœ°åŒºéšä¾¿é€‰æˆ‘é€‰äº†ç¾å›½
        #ä½œç”¨æ˜¯å¦‚æœä½ ç½‘é¡µç«¯ç™»å½•æ—¶æœ‰ç”¨å…¶ä»–è®¾å¤‡ç™»å½•ä¼šæœ‰é€šçŸ¥pushåˆ°ä½ æ‰‹æœº
        #iOSäº²æµ‹å¯ç”¨,å…¶ä»–ç«¯æ²¡æœ‰æµ‹è¯•è¿‡
      - PUSH_ENABLED=true
      - PUSH_INSTALLATION_ID=
      - PUSH_INSTALLATION_KEY=
        #é€šçŸ¥é‚®ä»¶çš„é…ç½®(å¯é€‰)
      - SMTP_HOST=
      - SMTP_PORT=
      - SMTP_SECURITY=starttls
      - SMTP_FROM=${SMTP_FROM}
      - SMTP_USERNAME=${SMTP_USER}
      - SMTP_PASSWORD=${SMTP_PASSWD}
        #æ˜¾ç¤ºå¯†ç æç¤º
      - SHOW_PASSWORD_HINT=true

        #æ—¥å¿—æ–‡ä»¶,ç”¨äºé…åˆfail2ban
      - LOG_FILE=/f2blogs/vaultwarden.log 
      - LOG_LEVEL=info
      - EXTENDED_LOGGING=true
</code></pre><h3 id=ç¼–è¾‘envç¯å¢ƒå˜é‡>ç¼–è¾‘<code>.env</code>ç¯å¢ƒå˜é‡</h3><p>åŒæ–‡ä»¶å¤¹ä¸‹é”®å…¥
<code>vim .env</code> æŒ‰<code>i</code>è¿›å…¥ç¼–è¾‘æ¨¡å¼</p><pre tabindex=0><code>VAULTWARDEN_ADMIN_TOKEN=
DB_NAME=
DB_USER=
DB_SECRET=
SMTP_FROM=
SMTP_USERNAME=
SMTP_PASSWD=
</code></pre><p>å¦‚æœä½¿ç”¨é»˜è®¤é…ç½®åˆ™ä¸éœ€è¦åœ¨.envæ–‡ä»¶ä¸­è®¾ç½®æ•°æ®åº“ä¿¡æ¯<code>"DB_"</code>çš„ç›¸å…³å˜é‡è‡ªè¡Œåˆ é™¤</p><p>å„ä¸ªå€¼éƒ½ç”¨å°å¼•å·<code>â€˜â€™</code>æ‹¬èµ·æ¥ã€‚</p><p>å¦‚æœå¯ç”¨ç®¡ç†å‘˜é¡µé¢.envæ–‡ä»¶é‡Œçš„<code>VAULTWARDEN_ADMIN_TOKEN</code>å€¼è¦é¿å…æ˜æ–‡,å¦‚ä½•è®¾ç½®å‚è€ƒ<a href=https://github.com/dani-garcia/vaultwarden/wiki/Enabling-admin-page>å®˜æ–¹wiki</a>ï¼Œ<a href=https://rs.ppgg.in/configuration/enabling-admin-page>ä¸­æ–‡ç‰ˆé¡µé¢</a>ã€‚</p><p>é…ç½®å®Œæˆååœ¨æ­¤æ–‡ä»¶å¤¹ä¸‹è¿è¡Œ
<code>docker compose up -d</code>
ä»¥å¯åŠ¨æœåŠ¡ã€‚
å¯ä½¿ç”¨å‘½ä»¤<code>docker ps</code>æ˜¯å¦æ­£å¸¸è¿è¡Œ</p><h3 id=é…ç½®åå‘ä»£ç†>é…ç½®åå‘ä»£ç†</h3><p>éœ€è¦æå‰å®‰è£…å¥½<code>nginxã€certbotã€python3-certbot-nginx</code></p><p>å¦‚æœæ²¡æœ‰å®‰è£…,æ‰§è¡Œ:</p><pre tabindex=0><code>apt update
apt install nginx certbot python3-certbot-nginx
</code></pre><p>åˆ›å»ºé…ç½®æ–‡ä»¶
<code>vim /etc/nginx/conf.d/vaultwarden.conf</code>
æŒ‰<code>i</code>è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œwikiä¸Šæœ‰<a href=https://github.com/dani-garcia/vaultwarden/wiki/Proxy-examples>ç¤ºä¾‹é…ç½®</a>,æˆ–è€…æŸ¥çœ‹ <a href=https://rs.ppgg.in/deployment/proxy-examples>æ±‰åŒ–ç‰ˆè¯´æ˜</a></p><p>ç”¨certbotç”³è¯·sslè¯ä¹¦,ä»¥ä¸‹äºŒé€‰ä¸€</p><ol><li>åœæ­¢nginx(<code>systemctl stop nginx</code>)åè¿è¡Œ<code>certbot certonly --standalone -d example.com</code>ç„¶åå†å»é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šsslè¯ä¹¦æ–‡ä»¶ä½ç½®ï¼Œå†è¿è¡Œ<code>systemctl restart nginx</code>é‡å¯nginx</li><li>ä¸åœæ­¢nginxï¼Œå°†é…ç½®æ–‡ä»¶çš„serverå—æ”¹æˆåªç›‘å¬80ç«¯å£ï¼Œè®©certbotè‡ªåŠ¨è®¾ç½®ä½ çš„sslè¯ä¹¦ä½ç½®ï¼Œæ‰§è¡Œ<code>certbot --nginx -d example.com</code></li></ol><p>æˆ‘ä½¿ç”¨ç¬¬äºŒç§ï¼Œä¸‹é¢æ˜¯ç¤ºä¾‹é…ç½®ï¼š</p><p><code>/etc/nginx/conf.d</code>æ–‡ä»¶å¤¹ä¸‹çš„<code>vaultwarden.conf</code>:</p><pre tabindex=0><code>server {
    listen 80;
    listen [::]:80;
    server_name example.com;



    client_max_body_size 200M;
location / {
      proxy_set_header   X-Real-IP $remote_addr;
      proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header   Host $host;
      proxy_pass         http://localhost:8888/;
      proxy_http_version 1.1;
      proxy_set_header   Upgrade $http_upgrade;
      proxy_set_header   Connection &#34;upgrade&#34;;
      proxy_set_header X-Forwarded-Proto $scheme;

      
  }
}
</code></pre><p>ç¼–è¾‘å¥½åï¼Œæ‰§è¡Œ<code>certbot --nginx -d example.com</code>åå¦‚æœæ²¡æœ‰æŠ¥é”™é‚£å°±æ˜¯å·²ç»è®¾ç½®ä¸Šäº†ï¼Œè¿™æ—¶å€™å†æŸ¥çœ‹è¿™ä¸ªé…ç½®ä¼šå‘ç°è¢«certbotè‡ªåŠ¨å¢åŠ ä¸Šäº†ssléƒ¨åˆ†ï¼Œæ‰“å¼€æµè§ˆå™¨è®¿é—®ä½ çš„ç½‘é¡µå§ã€‚</p><p>æˆ–è€…ä½ å¯ä»¥ç”¨<code>cf-tunnel</code>çš„æ–¹å¼è®¾ç½®<code>ssl</code>,é€‚åˆå®¶é‡Œäº‘è¿™ç§é…ç½®èµ·æ¥éº»çƒ¦çš„æƒ…å†µ,å¯å‚è€ƒå°‘æ•°æ´¾çš„<a href=https://sspai.com/post/79278>è¿™ç¯‡æ–‡ç« </a>ï¼Œ</p><p>ä¼˜ç‚¹æ˜¯ç›¸æ¯”å®¶é‡Œäº‘,æ²¡æœ‰ç«¯å£å·å°å°¾å·´,ä¸”é…ç½®ç®€å•</p><p>ç¼ºç‚¹æ˜¯å¯èƒ½å»¶è¿Ÿé«˜ï¼Œä½†è¿™ä¸ªå¯†ç åº“æ˜¯æœ¬åœ°å­˜å‚¨çš„ï¼Œåªæœ‰ä¿®æ”¹å¯†ç åº“æ—¶è¦è”ç½‘ï¼Œå¯¹å»¶è¿Ÿè¦æ±‚ä¸é«˜,å‹‰å¼ºèƒ½æ¥å—</p><p><strong>ä½¿ç”¨<code>cf-tunnel</code>çš„æˆ–è€…å¼€äº†<code>cloudflare</code>å°é»„äº‘çš„è¦å»ç®¡ç†é¡µé¢æŠŠå®¢æˆ·ç«¯IPæ ‡å¤´è®¾ç½®ä¸º<code>CF-Connecting-IP</code>å¦åˆ™fail2banä¸ä¼šèµ·ä½œç”¨</strong></p><h2 id=é…ç½®fail2ban>é…ç½®<code>fail2ban</code></h2><p><em>å³è¾“é”™å¯†ç <code>3</code>æ¬¡åä¼š<code>ban</code>æ‰<code>IP</code>ä¸€æ®µæ—¶é—´</em></p><blockquote><p>fail2banå¯ä»¥ç›´æ¥ç…§æ±‰åŒ–è¿‡çš„<a href=https://rs.ppgg.in/configuration/security/fail2ban-setup>wiki</a>æ¥ã€‚
å‡è®¾ä½ æŒ‰å®˜æ–¹çš„wikiè®¾ç½®äº†ä¸€å¯¹filterä¸jailè§„åˆ™<code>vaultwarden.local</code>(æŒ‰<code>wiki</code>åœ¨å¯¹åº”çš„æ–‡ä»¶å¤¹åˆ›å»ºå¯¹åº”çš„æ–‡ä»¶)ï¼Œæ‰§è¡Œ
<code>fail2ban-client status vaultwarden</code>æŸ¥çœ‹çŠ¶æ€</p></blockquote><h3 id=è®¾ç½®ç½‘é¡µç«¯çš„fail2ban>è®¾ç½®ç½‘é¡µç«¯çš„<code>fail2ban</code></h3><h4 id=åœ¨fail2bançš„filterdæ–‡ä»¶å¤¹åˆ›å»ºè§„åˆ™è¾“å…¥ä»¥ä¸‹å†…å®¹vim-etcfail2banfilterdvaultwardenlocal>åœ¨<code>fail2ban</code>çš„<code>filter.d</code>æ–‡ä»¶å¤¹åˆ›å»ºè§„åˆ™,è¾“å…¥ä»¥ä¸‹å†…å®¹<code>vim /etc/fail2ban/filter.d/vaultwarden.local</code></h4><pre tabindex=0><code># path_f2b/filter.d/vaultwarden.local

[INCLUDES]
before = common.conf

[Definition]
failregex = ^.*?Username or password is incorrect\. Try again\. IP: &lt;ADDR&gt;\. Username:.*$
ignoreregex =
</code></pre><h4 id=åœ¨fail2bançš„jaildæ–‡ä»¶å¤¹åˆ›å»ºè§„åˆ™è¾“å…¥ä»¥ä¸‹å†…å®¹vim-etcfail2banjaildvaultwardenlocal>åœ¨<code>fail2ban</code>çš„<code>jail.d</code>æ–‡ä»¶å¤¹åˆ›å»ºè§„åˆ™,è¾“å…¥ä»¥ä¸‹å†…å®¹<code>vim /etc/fail2ban/jail.d/vaultwarden.local</code></h4><pre tabindex=0><code># path_f2b/jail.d/vaultwarden.local

[vaultwarden]
enabled = true
port = 80,443,8081
filter = vaultwarden
banaction = %(banaction_allports)s
logpath = /path/to/vaultwarden.log  #ä½ çš„logæ–‡ä»¶çš„ç»å¯¹è·¯å¾„
maxretry = 3
bantime = 14400
findtime = 14400
</code></pre><h3 id=è®¾ç½®ç½‘é¡µç«¯adminç®¡ç†ç•Œé¢çš„fail2ban>è®¾ç½®ç½‘é¡µç«¯<code>admin</code>ç®¡ç†ç•Œé¢çš„<code>fail2ban</code></h3><h4 id=åœ¨fail2bançš„filterdæ–‡ä»¶å¤¹åˆ›å»ºè§„åˆ™è¾“å…¥ä»¥ä¸‹å†…å®¹vim-etcfail2banfilterdvaultwarden-adminlocal>åœ¨<code>fail2ban</code>çš„<code>filter.d</code>æ–‡ä»¶å¤¹åˆ›å»ºè§„åˆ™,è¾“å…¥ä»¥ä¸‹å†…å®¹<code>vim /etc/fail2ban/filter.d/vaultwarden-admin.local</code></h4><pre tabindex=0><code># path_f2b/filter.d/vaultwarden-admin.local

[INCLUDES]
before = common.conf

[Definition]
failregex = ^.*Invalid admin token\. IP: &lt;ADDR&gt;.*$
ignoreregex =
</code></pre><h4 id=åœ¨fail2bançš„jaildæ–‡ä»¶å¤¹åˆ›å»ºè§„åˆ™è¾“å…¥ä»¥ä¸‹å†…å®¹vim-etcfail2banjaildvaultwarden-adminlocal>åœ¨<code>fail2ban</code>çš„<code>jail.d</code>æ–‡ä»¶å¤¹åˆ›å»ºè§„åˆ™,è¾“å…¥ä»¥ä¸‹å†…å®¹<code>vim /etc/fail2ban/jail.d/vaultwarden-admin.local</code></h4><pre tabindex=0><code># path_f2b/jail.d/vaultwarden-admin.local

[vaultwarden-admin]
enabled = true
backend = pyinotify #ç”±äºæˆ‘ä½¿ç”¨çš„ç³»ç»Ÿæ˜¯Debianä»¥åŠæˆ‘ä½¿ç”¨çš„æ˜¯aptæ–¹å¼å®‰è£…çš„fail2ban,æŒ‰wikiè¯´æ³•è¿™é‡Œå¾—åŠ è¿™ä¸ª
port = 80,443
filter = vaultwarden-admin
banaction = %(banaction_allports)s
logpath = /path/to/vaultwarden.log #ä½ çš„logæ–‡ä»¶çš„ç»å¯¹è·¯å¾„
maxretry = 3
bantime = 14400
findtime = 14400
</code></pre><h3 id=totpçš„fail2banè®¾ç½®ç”¨äºvaultwardenå¸å·è®¾ç½®äº†äºŒæ¬¡éªŒè¯çš„><code>TOTP</code>çš„<code>fail2ban</code>è®¾ç½®,ç”¨äº<code>vaultwarden</code>å¸å·è®¾ç½®äº†äºŒæ¬¡éªŒè¯çš„</h3><h4 id=åœ¨fail2bançš„filterdæ–‡ä»¶å¤¹åˆ›å»ºè§„åˆ™è¾“å…¥ä»¥ä¸‹å†…å®¹vim-etcfail2banfilterdvaultwarden-totplocal>åœ¨<code>fail2ban</code>çš„<code>filter.d</code>æ–‡ä»¶å¤¹åˆ›å»ºè§„åˆ™,è¾“å…¥ä»¥ä¸‹å†…å®¹<code>vim /etc/fail2ban/filter.d/vaultwarden-totp.local</code></h4><pre tabindex=0><code># path_f2b/filter.d/vaultwarden-totp.local
# Fail2Ban filter for Vaultwarden TOTP

[INCLUDES]
before = common.conf

[Definition]
failregex = ^.*\[ERROR\] Invalid TOTP code! Server time: (.*) UTC IP: &lt;ADDR&gt;$
ignoreregex =
</code></pre><h4 id=åœ¨fail2bançš„jaildæ–‡ä»¶å¤¹åˆ›å»ºè§„åˆ™è¾“å…¥ä»¥ä¸‹å†…å®¹-vim-etcfail2banjaildvaultwarden-totplocal>åœ¨<code>fail2ban</code>çš„<code>jail.d</code>æ–‡ä»¶å¤¹åˆ›å»ºè§„åˆ™,è¾“å…¥ä»¥ä¸‹å†…å®¹ <code>vim /etc/fail2ban/jail.d/vaultwarden-totp.local</code></h4><pre tabindex=0><code># path_f2b/jail.d/vaultwarden-totp.local

[vaultwarden-totp]
enabled = true
backend = pyinotify #ç”±äºæˆ‘ä½¿ç”¨çš„ç³»ç»Ÿæ˜¯Debianä»¥åŠæˆ‘ä½¿ç”¨çš„æ˜¯aptæ–¹å¼å®‰è£…çš„fail2ban,æŒ‰wikiè¯´æ³•è¿™é‡Œå¾—åŠ è¿™ä¸ª
port = 80,443
filter = vaultwarden-totp
banaction = iptables-multiport[name=vaultwarden-totp, port=&#34;80,443&#34;, protocol=tcp]
logpath = /path/to/vaultwarden.log #ä½ çš„logæ–‡ä»¶çš„ç»å¯¹è·¯å¾„
maxretry = 3
bantime = 14400
findtime = 14400
</code></pre><p>é‡å¯fail2ban <code>sudo systemctl restart fail2ban</code> å³å¯ç”Ÿæ•ˆ</p><p>æŸ¥çœ‹å¯¹åº”çš„è§„åˆ™banäº†å¤šå°‘IP</p><pre tabindex=0><code>#æŸ¥çœ‹webç™»å½•å¤±è´¥å°ç¦çŠ¶å†µ
fail2ban-client status vaultwarden 
#å¦‚æœæŸä¸ªIPè®¿é—®ç™»å½•å¸å·é¡µé¢å¹¶è¾“é”™å¯†ç æˆ–è€…é‚®ç®±,3æ¬¡ä¼šbanIP(jailæ–‡ä»¶å¯¹åº”è§„åˆ™maxretry = 3)

#æŸ¥çœ‹ç®¡ç†å‘˜é¡µé¢ç™»å½•å¤±è´¥å°ç¦çŠ¶å†µ
fail2ban-client status vaultwarden-admin 
#å¦‚æœæŸä¸ªIPåœ¨ç™»å½•ç®¡ç†å‘˜é¡µé¢è¾“é”™å¯†ç ,3æ¬¡ä¼šbanIP(jailæ–‡ä»¶å¯¹åº”è§„åˆ™maxretry = 3)

#æŸ¥çœ‹äºŒæ¬¡éªŒè¯è¾“å…¥é”™è¯¯å°ç¦çŠ¶å†µ
fail2ban-client status vaultwarden-totp
#å¦‚æœæŸä¸ªIPåœ¨ç™»å½•vaultwardenæ—¶ï¼Œè¾“å…¥äºŒæ¬¡éªŒè¯æ—¶å‡ºé”™ä¼šè®°å½•,3æ¬¡ä¼šbanIP(jailæ–‡ä»¶å¯¹åº”è§„åˆ™maxretry = 3)
</code></pre><p>dockerå®‰è£…çš„fail2banå¯å»<a href=https://rs.ppgg.in/configuration/security/fail2ban-setup#jail>wiki</a>è‡ªå·±ç ”ç©¶</p><p>åˆ°æ­¤ä¸ºæ­¢åŸºæœ¬ç»“æŸäº†ã€‚</p><h2 id=å‚è€ƒ>å‚è€ƒ</h2><ol><li><a href=https://rs.ppgg.in/>Vaultwarden Wiki ä¸­æ–‡ç‰ˆ</a></li><li><a href=https://github.com/dani-garcia/vaultwarden/wiki>Vaultwarden Wiki(å®˜æ–¹wiki)</a></li><li><a href=https://sspai.com/post/79278>CloudFlare Tunnel å…è´¹å†…ç½‘ç©¿é€çš„ç®€æ˜æ•™ç¨‹</a></li></ol></article><div class="tags pb-4 pt-2"><a class="badge rounded-pill text-uppercase text-bg-secondary" href=/tags/%E5%A4%87%E5%BF%98%E5%BD%95/>å¤‡å¿˜å½•</a>
<a class="badge rounded-pill text-uppercase text-bg-secondary" href=/tags/%E8%87%AA%E9%83%A8%E7%BD%B2/>è‡ªéƒ¨ç½²</a>
<a class="badge rounded-pill text-uppercase text-bg-secondary" href=/tags/vaultwarden/>Vaultwarden</a></div><div class=row><div class=col-md></div><div class="col-md text-md-end"><a href=https://MrLeeYoungHoo.github.io/posts/mido%E5%A4%87%E5%BF%98%E5%BD%95/><span>next: </span><span>æŠŠçº¢ç±³note4xåˆ·æˆlinuxå°æœåŠ¡å™¨</span></a></div></div></div></div><footer><div class="container mt-4 pb-1"><p class="small opacity-75">yeo's blog Â© 2025
<a href="https://icp.gov.moe/?keyword=20240310" style=font-size:14px;color:gray;text-decoration:none>èŒICPå¤‡20240310</a> // powered by <a href=https://gohugo.io/>hugo</a> and <a href=https://github.com/imgios/not-much>imgios/not-much</a></p></div></footer></main><script src=https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js integrity=sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz crossorigin=anonymous></script></body></html>